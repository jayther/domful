(function(w){var window=w,document=window.document,Node=window.Node,HTMLElement=window.Element,console=window.console||{log:function(){},warn:function(){}},nativeTypes=["Boolean","Number","String","Function","Array","Date","RegExp","Object"],class2type={},isArray,isNode,isElement,extendObj,DEFAULT_OPTIONS={globalName:"DOMful",errorPrefix:"(DOMful) ",strict:true},tOpts,DOMful;(function(){var i;for(i=0;i<nativeTypes.length;i+=1)class2type["[object "+nativeTypes[i]+"]"]=nativeTypes[i].toLowerCase()})();
isArray=Array.isArray||function(objOrArr){return objOrArr===null?String(objOrArr):class2type[Object.toString().call(objOrArr)]||"object"};extendObj=function(base,obj,deep){var k,t,nObj={};for(k in obj)if(obj.hasOwnProperty(k))if(typeof obj[k]==="object"&&(!isArray(obj[k])&&(deep&&base.hasOwnProperty(k))))nObj[k]=extendObj(base[k],obj[k]);else nObj[k]=obj[k];for(k in base)if(base.hasOwnProperty(k)&&!nObj.hasOwnProperty(k))nObj[k]=base[k];return nObj};isNode=function(o){return typeof Node==="object"?
o instanceof Node:o&&(typeof o==="object"&&(typeof o.nodeType==="number"&&typeof o.nodeName==="string"))};isElement=function(o){return typeof HTMLElement==="object"?o instanceof HTMLElement:o&&(typeof o==="object"&&(o!==null&&(o.nodeType===1&&typeof o.nodeName==="string")))};DOMful=function(opt){var self=this,parse,parseToString,parser,processError,init;parser={stringToElement:function(elementString){if(elementString){var tag,classNames=[],id,i,el,matches,attributes={},parts,attrVal;matches=elementString.match(/\s/g);
if(matches&&matches.length>0)throw new Error("Nested selectors is not allowed. *sob*");matches=elementString.match(/\#\-?[_a-zA-Z]+[_a-zA-Z0-9\-]*/g);if(matches&&matches.length>0){id=matches[0].substring(1);attributes.id=id}matches=elementString.match(/\.\-?[_a-zA-Z]+[_a-zA-Z0-9\-]*/g);if(matches&&matches.length>0){for(i=0;i<matches.length;i+=1)classNames.push(matches[i].substring(1));attributes["class"]=classNames.join(" ")}matches=elementString.match(/\[[a-zA-Z_:]*?[\-a-zA-Z0-9_:.]+(?:\=["']?.+?["']?)?\]/g);
if(matches&&matches.length>0)for(i=0;i<matches.length;i+=1){parts=matches[i].split("=",2);if(parts.length===1)attributes[parts[0].substring(1,parts[0].length-1)]=null;else if(parts.length===2){attrVal=parts[1].substring(0,parts[1].length-1);if(attrVal[0]==='"'&&attrVal[attrVal.length-1]==='"'||attrVal[0]==="'"&&attrVal[attrVal.length-1]==="'")attrVal=attrVal.substring(1,attrVal.length-1);attributes[parts[0].substring(1)]=attrVal}}if(elementString.indexOf("#")!==-1)tag=elementString.substring(0,elementString.indexOf("#"));
else if(elementString.indexOf(".")!==-1)tag=elementString.substring(0,elementString.indexOf("."));else tag=elementString;if(tag&&tag.length>0){el=document.createElement(tag);for(i in attributes)if(attributes.hasOwnProperty(i))if(i==="class"&&el.hasOwnProperty("className"))el.className=attributes[i];else if(el.hasOwnProperty(i))el[i]=attributes[i];else el.setAttribute(i,attributes[i]);return el}}return null},stringToElementWithContent:function(opts){var o=extendObj({elementString:"",content:null,proper:false,
events:null},opts,true),elementString=o.elementString,content=o.content,proper=o.proper,events=o.events,element=parser.stringToElement(elementString),i,k,childs;if(content)if(typeof content==="function")element.innerHTML=content();else if(isElement(content))element.appendChild(content);else if(typeof content==="object"){childs=parser.objectToElements(content,proper);if(isArray(childs))for(i=0;i<childs.length;i+=1)element.appendChild(childs[i]);else element.appendChild(childs)}else element.innerHTML=
content.toString();if(events&&typeof events==="object")for(i in events)if(events.hasOwnProperty(i))if(typeof events[i]==="function")element.addEventListener(i,events[i],false);else if(isArray(events[i]))for(k=0;k<events[i].length;k+=1)if(typeof events[i][k]==="function")element.addEventListener(i,events[i][k],false);return element},objectToElements:function(objOrArr,proper){var i,element,elements=[];if(objOrArr)if(isArray(objOrArr))return parser.arrayToElements(objOrArr,proper,true);else if(isElement(objOrArr))return objOrArr;
else if(typeof objOrArr==="object")if(proper||objOrArr.tag){element=parser.stringToElementWithContent({elementString:objOrArr.tag,content:objOrArr.childs||objOrArr.content,events:objOrArr.events,proper:proper});if(element)elements.push(element)}else for(i in objOrArr){if(objOrArr.hasOwnProperty(i)){element=parser.stringToElementWithContent({elementString:i,content:objOrArr[i],proper:proper});if(element)elements.push(element)}}else if(typeof objOrArr==="string"){element=parser.stringToElement(objOrArr);
if(element)elements.push(element)}if(elements.length===1)return elements[0];return elements},arrayToElements:function(objOrArr,proper,isArr){var elements=[],i;if(isArr||isArray(objOrArr))for(i=0;i<objOrArr.length;i+=1)elements.push(parser.objectToElements(objOrArr[i],proper));return elements}};parse=function(objOrArr,repeat,proper){var els=null,el=null,i;if(typeof repeat!=="number")repeat=1;if(repeat>1)els=[];if(repeat>0)try{if(objOrArr)if(typeof objOrArr==="object"||typeof objOrArr==="string")for(i=
0;i<repeat;i+=1){el=parser.objectToElements(objOrArr,proper);if(el&&repeat>1)els.push(el);else els=el}else throw new Error("Parameter in parse function can only be an object or an array.");else throw new Error("Parameter in parse function cannot be null (only an object or an array).");}catch(e){processError(e)}return els};self.parse=parse;parseToString=function(objOrArr,repeat,proper){var dummy,els,i;try{els=parse(objOrArr,repeat,proper);if(els){dummy=document.createElement("div");if(isArray(els))for(i=
0;i<els.length;i+=1)dummy.appendChild(els[i]);else dummy.appendChild(els);return dummy.innerHTML}else throw new Error("Creation returned null.");}catch(e){processError(e)}return""};self.parseToString=parseToString;processError=function(e){var eIsString=typeof e==="string";if(self.strict)if(eIsString)throw new Error(self.errorPrefix+e);else{e.message=self.errorPrefix+e.message;throw e;}else if(typeof e==="string")console.warn(self.errorPrefix+e);else console.warn(self.errorPrefix+e.message)};init=
function(inst){var i,o=extendObj(DEFAULT_OPTIONS,opt||{});for(i in o)if(o.hasOwnProperty(i)&&(!inst.hasOwnProperty(i)&&DEFAULT_OPTIONS.hasOwnProperty(i)))inst[i]=o[i]};init(this)};tOpts=extendObj(DEFAULT_OPTIONS,window.DOMful||{});window[tOpts.globalName]=new DOMful(tOpts)})(window);
